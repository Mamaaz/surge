// Utility functions
const secondsToDhms = seconds => {
    const d = Math.floor(seconds / (3600 * 24));
    const h = Math.floor(seconds % (3600 * 24) / 3600);
    const m = Math.floor(seconds % 3600 / 60);
    return `${d > 0 ? d + "å¤©" : ""}${h > 0 ? h + "å°æ—¶" : ""}${m > 0 ? m + "åˆ†é’Ÿ" : ""}`;
}

const bytesToGB = bytes => (bytes / (1024 * 1024 * 1024)).toFixed(2);

// Retrieve URL from arguments or default
const arg = typeof $argument != 'undefined'
    ? Object.fromEntries($argument.split('&').map(item => item.split('=')))
    : { url: " ", title: 'Wiki-KR' };

// Panel setup
let panel = { title: arg.title, icon: arg.icon };

// Make request and handle response
$httpClient.get({ url: arg.url, timeout: 3000 }, (error, response, data) => {
    if (error) {
        console.log('error: ' + error);
        $done({ title: 'å•Šå‘ƒï½', content: 'å‡ºé”™äº†ï¼çœ‹çœ‹æ˜¯ä¸æ˜¯ç«¯å£æ²¡æ‰“å¼€ï¼Ÿ' + error });
    } else {
        const Data = JSON.parse(data);

        panel.content = `ğŸ•’ è¿è¡Œæ—¶é—´ï¼š${secondsToDhms(Data.uptime)}
        ğŸ’» å†…å­˜ä½¿ç”¨ï¼š${Data.max_mem_process_name}
        ğŸ“¥ å…¥ç«™: ${bytesToGB(Data.bytes_recv)} GB
        ğŸ“¤ å‡ºç«™: ${bytesToGB(Data.bytes_sent)} GB
        ğŸ’¾ ç”¨é‡: ${bytesToGB(Data.bytes_total)} GB
        ğŸ“Š æ€»é‡: 200 GB
        ğŸ–¥ï¸ CPU: ${Data.cpu_usage.toFixed(2)}%
        ğŸš€ å†…å­˜: ${Data.mem_usage.toFixed(2)}%
        ğŸ“… æœåŠ¡åˆ°æœŸæ—¶é—´ï¼šâ™¾ï¸
        `;

        $done(panel);
    }
});
