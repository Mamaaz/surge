// Utility functions
function secondsToDhms(seconds) {
    const d = Math.floor(seconds / (3600*24));
    const h = Math.floor(seconds % (3600*24) / 3600);
    const m = Math.floor(seconds % 3600 / 60);
    
    const dDisplay = d > 0 ? d + "å¤© " : "";
    const hDisplay = h > 0 ? h + "å°æ—¶ " : "";
    const mDisplay = m > 0 ? m + "åˆ†é’Ÿ" : "";
    
    return dDisplay + hDisplay + mDisplay; 
}

function bytesToGB(bytes) {
    return (bytes / (1024 * 1024 * 1024)).toFixed(2);
}

let your_url = " ";
let arg;
if (typeof $argument != 'undefined') {
    arg = Object.fromEntries($argument.split('&').map(item => item.split('=')));
};

const URL = arg?.url || your_url;

// Panel setup
let panel = { title: arg?.title || 'Wiki-KR', icon: arg?.icon };

// Request setup
const request = { url: URL, timeout: 3000 };

$httpClient.get(request, (error, response, data) => {
    if (error) {
        console.log(`Error: ${error}`);
        $done({ title: 'å•Šå‘ƒï½', content: `å‡ºé”™äº†ï¼çœ‹çœ‹æ˜¯ä¸æ˜¯ç«¯å£æ²¡æ‰“å¼€ï¼Ÿ${error}` });
    } else {
        const Data = JSON.parse(data);
        
        panel.content = `
            ğŸ•“ è¿è¡Œæ—¶é—´ï¼š${secondsToDhms(Data.uptime)}
            ğŸ§  å†…å­˜ä½¿ç”¨ï¼š${Data.max_mem_process_name}
            â¬‡ï¸ å…¥ç«™: ${bytesToGB(Data.bytes_recv)} GB  |  â¬†ï¸ å‡ºç«™: ${bytesToGB(Data.bytes_sent)} GB
            ğŸ” ç”¨é‡: ${bytesToGB(Data.bytes_total)} GB  |  ğŸ”® æ€»é‡: 200 GB
            ğŸ› CPU: ${Data.cpu_usage.toFixed(2)}%  |  ğŸš€ å†…å­˜: ${Data.mem_usage.toFixed(2)}%
            ğŸ“† æœåŠ¡åˆ°æœŸæ—¶é—´ï¼šâ™¾ï¸
        `;
        $done(panel);
    }
});
